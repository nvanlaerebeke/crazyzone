# Server Setup

This document describes how to set up the server the cluster will be running on.  
Described here will be more then just the k3s cluster setup, the server in question also runs VM's and some other services.

## Basic Setup

Install a minimal Ubuntu 24.04 or higher.  

## ZFS Setup

A ZFS pool is used for storing a backup of the NAS where all data is stored, this backup is run nighly.  
Additionally, a couple of datasets are created so that all data activity happens on the ZFS pool and the main nvme drive is not used.  

Create a pool called `data` and create the following datasets:

```console
root@home:/var/lib# zfs list -o name,mountpoint 
NAME          MOUNTPOINT
data          /data
data/kubelet  /var/lib/kubelet
data/libvirt  /var/lib/libvirt
data/logs     /var/log
data/rancher  /var/lib/rancher
data/tftp     /srv/tftp
```

### Dataset Overview

Kubelet:

The /var/lib/kubelet directory is a critical part of a Kubernetes node's file system.  
It is used by the kubelet, the primary node agent in Kubernetes, for storing data related to the operation of the node.

Libvirt:

The libvirt directory typically refers to a directory used by libvirt, which is an open-source API, daemon, and management tool for virtualization.  
This directory contains configuration files, logs, and other resources related to virtual machines (VMs) managed by libvirt.

Logs:

The /var/log directory in Linux and Unix-based systems is used to store log files generated by the system, applications, and services.  
These logs are essential for system administrators and developers to monitor the system's behavior, diagnose issues, and ensure everything is functioning properly.

Rancher:

The /var/lib/rancher directory is used by Rancher, a container management platform for deploying and managing Kubernetes clusters.  
This directory stores persistent data and configuration files related to Rancherâ€™s operation, as it acts as a central location for Rancher's state and runtime data.

Tftp:

The /srv/tftp directory is used as the storage location for files served by a TFTP (Trivial File Transfer Protocol) server.  
Typically for network booting purposes like PXE (Preboot Execution Environment). In this case, it's specifically used for storing the files needed for the Raspberry Pi netboot process.
